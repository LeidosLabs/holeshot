#!/bin/bash


tileImage() {
   srcImage="$1"
   "$JAVA_HOME/bin/java.exe" \
      -Dfile.encoding=UTF-8 \
      -classpath "$JAVA_HOME\jre\lib\resources.jar;$JAVA_HOME\jre\lib\rt.jar;$JAVA_HOME\jre\lib\jsse.jar;$JAVA_HOME\jre\lib\jce.jar;$JAVA_HOME\jre\lib\charsets.jar;$JAVA_HOME\jre\lib\jfr.jar;$JAVA_HOME\jre\lib\ext\access-bridge-64.jar;$JAVA_HOME\jre\lib\ext\cldrdata.jar;$JAVA_HOME\jre\lib\ext\dnsns.jar;$JAVA_HOME\jre\lib\ext\jaccess.jar;$JAVA_HOME\jre\lib\ext\jfxrt.jar;$JAVA_HOME\jre\lib\ext\localedata.jar;$JAVA_HOME\jre\lib\ext\nashorn.jar;$JAVA_HOME\jre\lib\ext\sunec.jar;$JAVA_HOME\jre\lib\ext\sunjce_provider.jar;$JAVA_HOME\jre\lib\ext\sunmscapi.jar;$JAVA_HOME\jre\lib\ext\sunpkcs11.jar;$JAVA_HOME\jre\lib\ext\zipfs.jar;F:\dev\leidoslabs\holeshot\ingest-service\target\classes;F:\dev\leidoslabs\holeshot\edh2-security-core\target\classes;F:\dev\.m2\repository\javax\inject\javax.inject\1\javax.inject-1.jar;F:\dev\.m2\repository\com\google\guava\guava\28.0-jre\guava-28.0-jre.jar;F:\dev\.m2\repository\com\google\guava\failureaccess\1.0.1\failureaccess-1.0.1.jar;F:\dev\.m2\repository\com\google\guava\listenablefuture\9999.0-empty-to-avoid-conflict-with-guava\listenablefuture-9999.0-empty-to-avoid-conflict-with-guava.jar;F:\dev\.m2\repository\com\google\code\findbugs\jsr305\3.0.2\jsr305-3.0.2.jar;F:\dev\.m2\repository\org\checkerframework\checker-qual\2.8.1\checker-qual-2.8.1.jar;F:\dev\.m2\repository\com\google\errorprone\error_prone_annotations\2.3.2\error_prone_annotations-2.3.2.jar;F:\dev\.m2\repository\com\google\j2objc\j2objc-annotations\1.3\j2objc-annotations-1.3.jar;F:\dev\.m2\repository\org\codehaus\mojo\animal-sniffer-annotations\1.17\animal-sniffer-annotations-1.17.jar;F:\dev\leidoslabs\holeshot\photogrammetry\target\classes;F:\dev\leidoslabs\holeshot\common\target\classes;F:\dev\.m2\repository\org\apache\commons\commons-collections4\4.1\commons-collections4-4.1.jar;F:\dev\.m2\repository\org\apache\commons\commons-text\1.6\commons-text-1.6.jar;F:\dev\.m2\repository\org\locationtech\spatial4j\spatial4j\0.7\spatial4j-0.7.jar;F:\dev\.m2\repository\org\apache\commons\commons-math3\3.6.1\commons-math3-3.6.1.jar;F:\dev\.m2\repository\org\apache\commons\commons-imaging\1.0-alpha1\commons-imaging-1.0-alpha1.jar;F:\dev\.m2\repository\org\apache\sis\core\sis-referencing\0.8\sis-referencing-0.8.jar;F:\dev\.m2\repository\javax\measure\unit-api\1.0\unit-api-1.0.jar;F:\dev\.m2\repository\org\opengis\geoapi\3.0.1\geoapi-3.0.1.jar;F:\dev\.m2\repository\org\apache\sis\core\sis-utility\0.8\sis-utility-0.8.jar;F:\dev\.m2\repository\org\apache\sis\core\sis-metadata\0.8\sis-metadata-0.8.jar;F:\dev\.m2\repository\org\apache\sis\core\sis-referencing-by-identifiers\0.8\sis-referencing-by-identifiers-0.8.jar;F:\dev\.m2\repository\org\apache\sis\non-free\sis-embedded-data\0.8\sis-embedded-data-0.8.jar;F:\dev\.m2\repository\org\apache\derby\derby\10.12.1.1\derby-10.12.1.1.jar;F:\dev\leidoslabs\holeshot\imageop\target\classes;F:\dev\.m2\repository\org\codice\imaging\nitf\codice-imaging-nitf-core\0.9-SNAPSHOT\codice-imaging-nitf-core-0.9-SNAPSHOT.jar;F:\dev\.m2\repository\org\codice\imaging\nitf\codice-imaging-nitf-core-api\0.9-SNAPSHOT\codice-imaging-nitf-core-api-0.9-SNAPSHOT.jar;F:\dev\.m2\repository\org\codice\usng4j\usng4j-api\0.1\usng4j-api-0.1.jar;F:\dev\.m2\repository\org\codice\usng4j\usng4j-impl\0.1\usng4j-impl-0.1.jar;F:\dev\.m2\repository\org\codice\imaging\nitf\codice-imaging-nitf-render\0.9-SNAPSHOT\codice-imaging-nitf-render-0.9-SNAPSHOT.jar;F:\dev\.m2\repository\org\apache\commons\commons-lang3\3.7\commons-lang3-3.7.jar;F:\dev\.m2\repository\commons-io\commons-io\2.6\commons-io-2.6.jar;F:\dev\.m2\repository\org\locationtech\jts\io\jts-io-common\1.16.1\jts-io-common-1.16.1.jar;F:\dev\.m2\repository\com\googlecode\json-simple\json-simple\1.1.1\json-simple-1.1.1.jar;F:\dev\.m2\repository\org\apache\commons\commons-jcs-core\2.2\commons-jcs-core-2.2.jar;F:\dev\.m2\repository\org\apache\commons\commons-jcs-jcache-tck\2.2\commons-jcs-jcache-tck-2.2.jar;F:\dev\.m2\repository\org\apache\commons\commons-jcs-jcache\2.2\commons-jcs-jcache-2.2.jar;F:\dev\.m2\repository\javax\cache\test-domain\1.0.0\test-domain-1.0.0.jar;F:\dev\.m2\repository\javax\cache\cache-api\1.0.0\cache-api-1.0.0.jar;F:\dev\.m2\repository\javax\cache\app-domain\1.0.0\app-domain-1.0.0.jar;F:\dev\.m2\repository\javax\transaction\jta\1.1\jta-1.1.jar;F:\dev\.m2\repository\org\apache\commons\commons-jcs-jcache-openjpa\2.2\commons-jcs-jcache-openjpa-2.2.jar;F:\dev\.m2\repository\org\apache\commons\commons-jcs-jcache-extras\2.2\commons-jcs-jcache-extras-2.2.jar;F:\dev\.m2\repository\commons-logging\commons-logging\1.2\commons-logging-1.2.jar;F:\dev\.m2\repository\org\apache\sis\core\sis-feature\0.8\sis-feature-0.8.jar;F:\dev\.m2\repository\org\apache\sis\storage\sis-storage\0.8\sis-storage-0.8.jar;F:\dev\.m2\repository\org\apache\sis\storage\sis-geotiff\0.8\sis-geotiff-0.8.jar;F:\dev\.m2\repository\commons-daemon\commons-daemon\1.0.15\commons-daemon-1.0.15.jar;F:\dev\.m2\repository\commons-cli\commons-cli\1.4\commons-cli-1.4.jar;F:\dev\.m2\repository\com\amazonaws\aws-lambda-java-core\1.2.0\aws-lambda-java-core-1.2.0.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-sns\1.11.221\aws-java-sdk-sns-1.11.221.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-core\1.11.221\aws-java-sdk-core-1.11.221.jar;F:\dev\.m2\repository\org\apache\httpcomponents\httpclient\4.5.4\httpclient-4.5.4.jar;F:\dev\.m2\repository\org\apache\httpcomponents\httpcore\4.4.7\httpcore-4.4.7.jar;F:\dev\.m2\repository\commons-codec\commons-codec\1.10\commons-codec-1.10.jar;F:\dev\.m2\repository\software\amazon\ion\ion-java\1.0.2\ion-java-1.0.2.jar;F:\dev\.m2\repository\com\fasterxml\jackson\dataformat\jackson-dataformat-cbor\2.6.7\jackson-dataformat-cbor-2.6.7.jar;F:\dev\.m2\repository\joda-time\joda-time\2.8.1\joda-time-2.8.1.jar;F:\dev\.m2\repository\com\amazonaws\jmespath-java\1.11.221\jmespath-java-1.11.221.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-sqs\1.11.221\aws-java-sdk-sqs-1.11.221.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-cloudwatch\1.11.221\aws-java-sdk-cloudwatch-1.11.221.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-cloudwatchmetrics\1.11.221\aws-java-sdk-cloudwatchmetrics-1.11.221.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-dynamodb\1.11.221\aws-java-sdk-dynamodb-1.11.221.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-s3\1.11.221\aws-java-sdk-s3-1.11.221.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-kms\1.11.221\aws-java-sdk-kms-1.11.221.jar;F:\dev\.m2\repository\com\amazonaws\aws-lambda-java-events\1.3.0\aws-lambda-java-events-1.3.0.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-cognitoidentity\1.11.0\aws-java-sdk-cognitoidentity-1.11.0.jar;F:\dev\.m2\repository\com\amazonaws\aws-java-sdk-kinesis\1.11.0\aws-java-sdk-kinesis-1.11.0.jar;F:\dev\.m2\repository\com\amazonaws\aws-lambda-java-log4j\1.0.0\aws-lambda-java-log4j-1.0.0.jar;F:\dev\.m2\repository\log4j\log4j\1.2.17\log4j-1.2.17.jar;F:\dev\.m2\repository\org\slf4j\slf4j-log4j12\1.8.0-beta0\slf4j-log4j12-1.8.0-beta0.jar;F:\dev\.m2\repository\org\locationtech\jts\jts-core\1.16.1\jts-core-1.16.1.jar;F:\dev\.m2\repository\com\fasterxml\jackson\core\jackson-annotations\2.9.4\jackson-annotations-2.9.4.jar;F:\dev\.m2\repository\com\fasterxml\jackson\core\jackson-core\2.9.4\jackson-core-2.9.4.jar;F:\dev\.m2\repository\com\fasterxml\jackson\core\jackson-databind\2.9.4\jackson-databind-2.9.4.jar;F:\dev\.m2\repository\javax\media\jai_core\1.1.3\jai_core-1.1.3.jar;F:\dev\.m2\repository\javax\media\jai_codec\1.1.3\jai_codec-1.1.3.jar;F:\dev\.m2\repository\it\geosolutions\jaiext\scale\jt-scale\1.1.10\jt-scale-1.1.10.jar;F:\dev\.m2\repository\it\geosolutions\jaiext\iterators\jt-iterators\1.1.10\jt-iterators-1.1.10.jar;F:\dev\.m2\repository\it\geosolutions\jaiext\utilities\jt-utilities\1.1.10\jt-utilities-1.1.10.jar;F:\dev\.m2\repository\it\geosolutions\jaiext\vectorbin\jt-vectorbin\1.1.10\jt-vectorbin-1.1.10.jar;F:\dev\.m2\repository\it\geosolutions\jaiext\translate\jt-translate\1.1.10\jt-translate-1.1.10.jar;F:\dev\.m2\repository\javax\media\jai_imageio\1.1\jai_imageio-1.1.jar;F:\dev\.m2\repository\com\github\jai-imageio\jai-imageio-core\1.4.0\jai-imageio-core-1.4.0.jar;F:\dev\.m2\repository\org\slf4j\slf4j-api\1.8.0-beta0\slf4j-api-1.8.0-beta0.jar" \
      com.leidoslabs.holeshot.ingest.AWSTilePyramidApp \
      --force \
      "$destBucket" \
      "$metadataSNSTopic" \
      "$srcImage"
      # --metadataonly
}


srcBucket="${1:-/cygdrive/f/dev/leidoslabs/images}"
destBucket="${2:-advanced-analytics-geo-tile-images}"
metadataSNSTopic="${3:-advanced-analytics-image-metadata}"

find $1 \( -iname \*.ntf -o -iname \*.nitf -o -iname \*.tif -o -iname \*.tiff \) -print |
while read image
do
   winName="$(cygpath -w $image)"
   echo "tiling $winName"
   tileImage "$winName"
done
